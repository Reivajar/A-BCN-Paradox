\documentclass[11pt]{article}
\usepackage{geometry}                
\geometry{letterpaper}                   

\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{epstopdf}
\usepackage{natbib}
\usepackage{amssymb, amsmath, bm}
\usepackage{booktabs}
\PassOptionsToPackage{hyphens}{url}\usepackage{hyperref}
\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}

\usepackage[nottoc,numbib]{tocbibind}

%\title{Title}
%\author{}
%\date{date} 

\begin{document}


\input{cover}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newpage
\section*{Agreement for free-download}
\bigskip


\bigskip


\large We hereby agree to make our source code for this project freely available for download from the web pages of the SOMS chair. Furthermore, we assure that all source code is written by ourselves and is not violating any copyright restrictions.

\begin{center}

\bigskip


\bigskip


\begin{tabular}{@{}p{2cm}@{}p{6cm}@{}@{}p{6cm}@{}}
\begin{minipage}{2cm}

\end{minipage}
&
\begin{minipage}{6cm}
\large Javier \\ Argota Sánchez-Vaquerizo

\end{minipage}
&
\begin{minipage}{6cm}

\large Daniel \\ Schwarzenbach

\end{minipage}
\end{tabular}


\end{center}
\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



% IMPORTANT
% you MUST include the ETH declaration of originality here; it is available for download on the course website or at http://www.ethz.ch/faculty/exams/plagiarism/index_EN; it can be printed as pdf and should be filled out in handwriting


%%%%%%%%%% Table of content %%%%%%%%%%%%%%%%%

\tableofcontents

\newpage

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\section{Abstract}

Following the evolution of last urban trends in re-purposing the public space for improving quality of life in cities, there is an increasing shrinkage of space for cars. Among these initiatives, Barcelona Superblocks is one of the most paradigmatic. As frequent in urban planning, the systematic analysis and evidence construction of these interventions are frequently ignored. In this experiment we proposed to analyze the traffic outcomes of the implementation of this Superblocks plan in an idealized Barcelona grid together with other potential scenarios to be as well implemented. By connecting urban interventions in city street networks with their expected outcomes we highlight the promising capabilities of the use of these methods based on modeling and simulation to question, criticise, iterate, and test city making processes in an accessible way for any stakeholder, both experts and lay people.    

\section{Individual contributions}

\begin{itemize}
    \item Javier Argota Sánchez-Vaquerizo was in charge of the data collection and model design and implementation.
    \item Daniel Schwarzenbach reviewed existing Braess Paradox literature and prepared the presentation.
\end{itemize}

\section{Introduction and Motivations}

\subsection {Towards a systematic understanding of urban spaces}

Utilitarian traffic optimization goals has dominated transport engineering since it appears as a proper discipline with the rise of private motorized vehicles. It has shaped our industrial and post-industrial cities that we inhabit. Modern Urbanism, as we understand it nowadays, sinks its roots at into a revolutionary scientific and technical approach towards the understanding of urban environment conditions and the efficient distribution of people, good, and resources around the city \citep{Cerda1867}. Even Modernist urban planners and architects in the early 1900's endorsed a radical mechanistic understanding of cities \citep{CIAM1933}. However, this scientific and positivist approach of traffic engineers contradicts the common practice in urban and city planning. Spatial planning, urban design, and collateral disciplines in the same realm, are affected by a combination of experimental data, domain expertise, ideology, and policy and political constraints in a non-straightforward decision making process in which opposed agendas promoted by different stakeholders are leverage to reach ideally a feasible compromise. In the best case scenario, many urban interventions are based on some domain expertise-backed intuition with the hope of eventually getting people's approval and political adoption.

The understanding of complex effects of spatial planning decisions in cities is still very limited and scarcely applied to common practice. In this context, the assessment of urban interventions in cities frequently lacks evidence support. It undermines any possibility of evaluation of results, iterative process of potential improvement, and proper informed-decision making for technical experts, decision makers, and citizens in general. The later is particularly relevant as this lack of comprehensive information on the effects of planning decisions in cities dismisses the quality of participatory processes, by masking accessible knowledge to people, and making easier to manipulate these processes \citep{Blundell-Jones2005}\citep{Plaza2020}.

\subsection {Barcelona's Superblocks}

This knowledge and methodological gap does not hinder experimentation and innovation in the most complex human creation \citep{Levi-Strauss1955} as cities are. In recent years, there is a clear trend on reducing the space reserved for private motor vehicles in cities to improve air quality and environmental conditions, to foster alternative transportation modes, or to reduce the use of fossil fuels (***citations would be good here*** and as well ***examples of these interventions***). Among these current trends on urban planning, Barcelona's Superblocks has been one of the most published in the last years (***some refs from The Guardian, NYT, etc***). The Superblock's plan aims to reduce the space for the motor private vehicles in the street network to improve living conditions of city inhabitants by reducing noise and air-pollution and giving room to other transportation modes without a proportional drop-off in the circulation of vehicles for the same level of service \citep{Rueda2018}. It is being accomplished by creating large blocks of 3-by-3 of current square city blocks and leaving inside only loop-like residential streets. It means that 1 out of 3 streets of the city are left for driving through traffic. The well-known and a-thousands-of-times depicted idiosyncrasy of the so regular Barcelona grid comes together with a long tradition on public engagement on urban planning and experimentation in the city set an ideal scenario for testing out the unknown effect of these and other modifications in urban networks.

\begin{figure}[h]
\centering
\includegraphics[scale=0.5]{bcn_superblocks_rueda_2018.png}
\caption{Barcelona Superblocks schema \citep{Rueda2018}}
\label{fig:Barcelona Superblocks schema}
\end{figure}

\subsection {The Braess Paradox}

Among one of the most interesting and intriguing effects that defies the common understanding for operating in the urban infrastructures is the so-called Braess Paradox. It explains the counter-intuitive observation that adding more links to a given network, such as a transportation one, can slow down overall traffic flow. It is caused by the selfishly behavior of the entities that are moving in the network when trying to optimize individually their travel time (or cost). It causes to get away from the system optimum. that contrary to the real behavior, requires some level of collaboration between the agents \citep{Braess1969}.

\subsection {Research questions}

\begin{itemize}
    \item Are there too many streets for cars that actually are causing bigger congestion?
    \item If adding new roadways links leads to increased congestion, according to Braess, may removing streets for vehicles cause improvement of traffic, as expected by the Superblocks plan?
    \item Can we apply the counter-intuitive Braess’ Paradox effects for our own benefit in the planning of cities?
\end{itemize}

\subsection {Research Methods}

For modeling and simulating an urban environment to test these changes, a microscopic agent-based simulation approach is used. SUMO is a common framework applied to transportation modeling in cities that implements among others enhancements, a car-following microscopic simulation model. This software can simulate virtually any element moving around a city or region as individual agents according to different rules \citep{Lopez2018}.

Additionally, this software allows to run mesoscopic simulations based on a queueing approach: it is, instead of simulating every agent behavior independently as in an agent-based approach, every street segment is modeled as a queue of vehicles \citep{Eissfeldt2004}. This approach implies important performance improvements that can be used for simulating larger environments (i.e. an entire city). Consequently, for validating the results of the microsimulation a mesoscopic model is calibrated. It will be as well useful for being able to run larger scenarios more efficiently. 

\section{Description of the Model}

In order to build a simulation in SUMO, two basic elements are needed as initial inputs:
\begin{itemize}
    \item A \textbf{network}, as the representation of the 'physical' environment where agents will move.
    \item  A \textbf{demand} able to generate the movement between the different locations of the environment.
\end{itemize}

\subsection {Network}

The idea behind the used environment is to generalize and abstract the main features defining the regular urban grid of the Barcelona Eixample district. Any particular area of the city of Barcelona is modeled \textit{per se}, but just a representation of the most important features of the urban fabric. This is facilitated by the clear and straightforward ideas that back the Cerda's plan.

An section of the city made of 9x9 Barcelona's blocks is used as the base environment. It is equivalent roughly to 1.44 km\textsuperscript{2}. Each squared block (or if preferred, the distance between the center of the streets intersections) is 133.33 m long. All the streets have the same width and importance (i.e. there is no hierarchy in the urban fabric) and they are one-way, two-lanes, with opposing directions from one block to the following one. Additionally each intersection is regulated with traffic lights whose whole cycle last 90 seconds\footnote{Whole sequence is: 42" GGGrrr, 3" yyyrrr, 42" rrrGGG, 3" rrryyy.}.

This basic network with the aforementioned parameters represents an idealization or abstraction of the current functioning of the street network in Barcelona (net 1). It is used as the basis for the modified scenarios where different changes are introduced as follows.

Two different settings for superblocks are represented: one made of 2x2 superblocks, and another one with 3x3 superblocks. Both models have been implemented already as pilot project in recent urban refurbishments in the city of Barcelona, although the latter is the original proposed design. Both settings follow the same design principles: major streets separating superblocks are the only ones suitable for cross-city traffic, and their intersections are regulated by traffic lights. Inner streets within each superblock are transformed in residential streets suitable for just residential traffic and other types of transportation. More importantly, for the model design, they are designed as one-lane and one-way loops that do not allow to cross the superblock, which makes impossible cross-city traffic. Consequently, they result into nets 2 and 3.

Finally, a fourth network is included to account for a remarkable feature of the Barcelona grid: the number of diagonal streets that cut the orthogonal grid. For this purpose, the Diagonal Avenue is taken as a reference for capturing its main features to be added to the basic grid. As a result, a diagonal broad street with two-ways and two lanes per direction is added at and angle of 30°. This is net 4.

\begin{figure}[htbp]
\centering
\includegraphics[scale=0.35]{bcn_paradox_4nets.PNG}
\caption{From left to right: Net 1 (basic network), net 2 (2x2 superblocks), net 3 (3x3 superblocks), and net 4 (with diagonal broad avenue).}
\label{fig:From left to right: Net 1 (basic network), net 2 (2x2 superblocks), net 3 (3x3 superblocks), and net 4 (with diagonal broad avenue).}
\end{figure}


\begin{table}[htbp]
\centering
\caption{Main metrics for each network.}
\label{tab:Nets-features}
\resizebox{\textwidth}{!}{%
\begin{tabular}{@{}rcccc@{}}
\toprule
\textbf{Network} & \textbf{Net 1} & \textbf{Net 2} & \textbf{Net 3} & \textbf{Net 4} \\ \toprule
Description & Basic network & 2x2 superblocks & 3x3 superblocks & w/ diagonal avenue \\ \midrule
Length of lanes (m) & 53920 & 36588 & 34261 & 58919 \\ \midrule
Length of lanes (\%) & 100 & 68 & 64 & 109 \\ \midrule
Number of intersections & 100 & 25 & 16 & 105 \\ \bottomrule
\end{tabular}%
}
\end{table}

\subsection {Demand}

For the creation of the demand, two different kinds of mobility need to be considered:
\begin{itemize}
    \item People whose origin and/or destination is within the represented area (i.e. people living and/or working within the network). This *endogenous* demand can be created using the ACTIVITYGEN tool included in SUMO from general demographic data \citep{Lopez2018}.
    \item People exclusively crossing the modeled area (i.e. people who are moving around the city, whose destination is somewhere else out of the represented part of the city). This passing through traffic can be modeled from AADT available data.
\end{itemize}

In general, the regular grid of the city of Barcelona encompasses core urban districts and more residential, suburbial, and even industrial areas whose traffic demands vary largely. In this case, for the considered area, we are assuming that it belongs to a central part of the city which implied higher density of population, of economic activity, of jobs position, and in general of traffic levels (because of inner demand, and passing by population).

Very similarly to the network creation process, we generalize the transportation demand for an equivalent area of the city to the modeled 1.44 km\textsuperscript{2} urban square without representing any concrete neighborhood of the city of Barcelona.

In the case of the transport demand created by *activitygen*, it needs basic demographic data which is extrapolated and generalized for the modeled network area (1.44 km\textsuperscript{2}) based on the Eixample district in Barcelona (7.46 km\textsuperscript{2}) \citep{AjuntamentdeBarcelona2018}\citep{AreadeBarcelona.AutoritatdelTransportMetropolita2020}\citep{DepartamentdAnalisiOficinaMunicipaldeDades.AjuntamentdeBarcelona2020}. This area matches approximately the assumption of the expected mobility levels for a central part of Barcelona. As a result, the following population statistics are assumed for the modeled area and they are parsed into a XML configuration file (see code folder) required by the tool for generate the demand:

\begin{table}[htbp]
\centering
\caption{Population statistics for the modeled area used in ACTIVITYGEN}
\label{tab:pop-stats}
\resizebox{\textwidth}{!}{%
\begin{tabular}{@{}rll@{}}
\toprule
metric &  & \textit{notes} \\ \midrule
\textbf{population (hab.)} & 51120 & \textit{assuming 355 hab/ha x 144 ha.} \\ \midrule
\textbf{persons per household} & 2.4 & \textit{} \\ \midrule
\textbf{population under 16 years old} & 14\% & \textit{} \\ \midrule
\textbf{population (16-64 years old)} & 65\% & \textit{} \\ \midrule
\textbf{population over 64 years old} & 21\% & \textit{} \\ \midrule
\textbf{schools} & 12 & \textit{58 schools (private and public, primary, middle and high schools)in the whole district.} \\ \midrule
\textbf{total students (3-16 years old)} & 4800 & \textit{20\% of the 24000 students in the whole district. 70\% don't move to a different area.} \\ \midrule
\textbf{vehicles per 1000 inhabitants} & 298 & \textit{} \\ \midrule
\textbf{share of private vehicle in Barcelona} & 22.8\% & \textit{} \\ \bottomrule
\end{tabular}%
}
\end{table}

For generalizing the driving-through traffic three neighborhoods belonging to the Eixample district are chosen as a reference for their inbound and outbound mobility patterns (i.e. people who leave or enter the area in a daily basis) \citep{BestiarioProyectosS.L.2014}. They are the ones showing a more more complex and demanding dynamics: La Dreta de l'Eixample, l'Antiga Esquerra de l'Eixample, and la Nova Esquerra de l'Eixample.

\begin{table}[htbp]
\centering
\caption{Demographic and mobility data for reference neighborhoods.}
\label{tab:hoods-ref}
\resizebox{\textwidth}{!}{%
\begin{tabular}{@{}rccc@{}}
\toprule
Neighborhood & \textbf{Dreta de l'Eixample} & \textbf{\begin{tabular}[c]{@{}c@{}}L'Antiga Esquerra \\ de l'Eixample\end{tabular}} & \textbf{\begin{tabular}[c]{@{}c@{}}La Nova Esquerra \\ de l'Eixample\end{tabular}} \\ \toprule
Total population & 43449 & 42189 & 57889 \\ \midrule
Area (km2) & 2.12 & 1.23 & 1.34 \\ \midrule
Density (hab/km2) & 20500 & 34355 & 43200 \\ \midrule
Outbound mobility (\% tot. pop.) & 30 & 32 & 32 \\ \midrule
Inbound mobility (\% tot. pop.) & 138 & 66 & 32 \\ \bottomrule
\end{tabular}%
}
\end{table}

Averaging these mobility patterns, we can assume for the model:
\begin{itemize}
    \item Outbound mobility: 31.4\% of tot. population of the model
    \item Inbound mobility: 74\% of tot. population of the model
\end{itemize}

Finally, these total daily values can be adjusted to an hourly distribution of trips during the day for generating random trips (see randomTrips.py script from SUMO) between the fringe edges (i.e. streets situated on the limit of the network that are used for entering and exiting the model). In this case the hourly distribution of the trips is obtained from the histogram generated by the ACTIVITYGEN tool used for the endogenous demand. 

As a result, a total of 315000 vehicles are included into the model by adding the vehicles from the endogenous demand and the driving through traffic.

The initial validation of this demand modeling is performed immediately by comparing the outcomes of the hourly histogram of modeled trips to the measured total trips by the metropolitan authorities in Barcelona \citep{AreadeBarcelona.AutoritatdelTransportMetropolita2020} and the expected counting of vehicles in a similar area from the real AADT \citep{AjuntamentdeBarcelona2016}.

\section{Implementation}

The proposed experiments assume that the demand does not change in each of the four designed networks. What changes is the topological and spatial features of the urban fabric represented by the four proposed networks, not the transportation demand which remains the same. 

In order to perform a wider sensitivity analysis and increase the scenarios considered, a scaling factor is applied to the demand. Using as a reference the scale factor of 1, equivalent to the demand modeling built from the real world data (i.e. 315000 vehicles extrapolated from the existing data), the simulation is run for each network 40 times, spanning from a scale of 0.05 (equivalent to a low demand case of only 15750 vehicles) up to a scale of 2.0 (which equals 630000 vehicles, the double of the current basic scenario), in increments of 0.05 (it is, adding 15750 vehicles). This approach allows to explore a large range of traffic demand levels and identify the different behavior that the proposed network can face under a diversity of situations.

Additionally, to overcome some limitations of the model under very high levels of traffic, which lead to congestion and saturation, an additional correcting factor is introduced regarding the so-called "teleporting". It refers to a resource used by SUMO for overcoming congested situations by moving a vehicle in a jam if it stays stuck for longer than a given period of time ahead on its route. But even, with very intense levels of traffic teleporting cannot make enough room for all the allocated vehicles, and it can lead to grid-lock scenarios. Then, a finalization clause is introduced based on the number of teleports. If the simulation teleports more than the 0.5 \% of the total allocated vehicles, the simulations ends. It can be understood like a way of testing if the amount of vehicles exceeds clearly the capacity of the network, and it aborts the simulation consequently while capturing metrics from very congested scenarios.

From each simulation run, macroscopic metrics at the lane level and at the whole network scale are extracted. \footnote{See code instructions and particularly, sumo.cfg configurations files where the additional files are called for generating the required output metrics at the lane level.}. The aggregated summary for the whole network are aimed to check the overall performance of the different simulations with different scaling factors on traffic demand \footnote{See visualization scripts. First optional routine for network performance is based in summary files.}. Complementary, the lane-based output files are used as the source data for building the Macroscopic Fundamental Diagram (MFD) \citep{Geroliminis2008}. For this purpose, metrics are generated every minute of simulation. It means, that every run of the simulation is sampled 3600 times, and every network is sampled about 30000 times \footnote{Mathematically, the theoretical number of total samples for the 40 runs in each network would be 72000. However, as high traffic intensity scenarios are aborted due to excess of teleporting, the final total number of samples is smaller.} for creating the MFD diagrams.

The mesoscopic simulations performed for validation of the microscopic model, and for expansion to larger environments, follow the same general approach. However, they require calibration of the parameters involved in the queuing approach of their model \footnote{For further information, check \textit{3.2 General approach based on time-headways ($\mu-Queue$)} in \citep{Eissfeldt2004}} for matching the microscopic behavior. 

\begin{table}[htbp]
\centering
\caption{Parameters for mesoscopic simulation\footnotemark}
\label{tab:meso-params}
\begin{tabular}{@{}rcccc@{}}
\toprule
 & \multicolumn{1}{l}{\textbf{trial01}} & \multicolumn{1}{l}{\textbf{trial02}} & \multicolumn{1}{l}{\textbf{trial03}} & \multicolumn{1}{l}{\textit{\textbf{default}}} \\ \toprule
\textbf{edgelength} & 135 & 135 & 135 & \textit{98} \\ \midrule
\textbf{lane-queue} & true & true & true & \textit{false} \\ \midrule
\bm{$\tau_{ff}$} & 1 & 2.1 & 1.13 & \textit{1.13} \\ \midrule
\bm{$\tau_{fj}$} & 1.2 & 0.75 & 1.13 & \textit{1.13} \\ \midrule
\bm{$\tau_{jf}$} & 1.8 & 0.75 & 1.73 & \textit{1.73} \\ \midrule
\bm{$\tau_{jj}$} & 1.4 & 0.5 & 1.4 & \textit{1.4} \\ \midrule
\textbf{tls-penalty} & 2 & 0 & 0 & \textit{0} \\ \midrule
\textbf{jam-threshold} & -1 & -0.5 & -1 & \textit{-1} \\ \midrule
\textbf{junction-control} & false & true & true & \textit{false} \\ \bottomrule
\end{tabular}
\end{table}

\footnotetext{Most of the adjustment has been based on heuristics, as it will be discussed later. However, some of the parameters chosen are based on the actual behavior of the microscopic simulation. For instance, the length of the segments is increased to 135 meters to ensure that the segments between intersections are not subdivided artificially, multi-lane is enforced, and junction-control approximates the behavior of actual traffic lights. For further information: https://sumo.dlr.de/docs/sumo.html#mesoscopic and https://sumo.dlr.de/docs/Simulation/Meso.html}

Routing is computed only once, directly from the demand creation (see section \textit{4.2. Demand}) at the beginning of model configuration. It means that any kind of dynamic re-computation of optimal routes given traffic conditions in real-time is not implemented, meaning that alternative routes for avoiding traffic jams during the simulation are disregarded. 

SUMO includes several routing algorithms\footnote{Dijikstra (the by-default setting), A*, and Contraction hierarchies in two different implementations. See: https://sumo.dlr.de/docs/Simulation/Routing.html} which are used for computing the routes from trips definitions. During the development of the simulation, all of them are tested both from the computation performance and the simulation results perspective. Finally, Contraction hierarchies are implemented for performance reasons, although Dijkstra provides equivalent results for the simulations.

\section{Simulation Results and Discussion}
\subsection{Metrics pre-processing}
For each of the four proposed network settings, a Macroscopic Fundamental Diagram is created, where flow and density of vehicles are plotted altogether from sampling every 60 seconds. 
Flow of vehicles per hour $\Phi$ at a given time \textit{t} of the simulation is computed from the output files according to

\begin{equation}
\Phi _t = \frac{\frac{\sum_{i}^{n}(\Phi_{in(i)}^t+\Phi_{started(i)}^t)}{T}\times 3600}{n}
\end{equation}

where \testit{T} is the sampling period (60 seconds), \textit{n} is the number of edges in the network, $\Phi_{in(i)}^t$ is the number of vehicles that entered a given edge \textit{i} within the time period \textit{t}, and $\Phi_{started(i)}^t$ are the vehicles that started their trip from the given edge \textit{i} during \textit{t}.
The density of vehicles per km \textit{d} at a given time period \textit{t} of the simulation is
\begin{equation}
    d_t= \frac{\frac{\sum_{n}^{i}Q_{i}^t}{T}}{L/1000}
\end{equation}
where $Q_{i}^t$ is the number of vehicles counted on the edge in each second summed up over the measurement interval \textit{t} that lasts \textit{T}, and \textit{L} is the total lanes length of the network in meters.

For characterizing each of these flow/density measurements distributions, the data points are interpolated for obtaining a smooth definition. Firstly, a Piecewise Cubic Hermite Interpolating Polynomial\footnote{See \url{https://docs.scipy.org/doc/scipy-0.18.1/reference/generated/scipy.interpolate.PchipInterpolator.html}} is applied to the distribution, followed by a Locally Weighted Scatterplot Smoothing (LOWESS) function\footnote{See \url{https://www.statsmodels.org/stable/generated/statsmodels.nonparametric.smoothers_lowess.lowess.html}}. Consequently, a clear definition of the flow/density relationship is obtained whose optimal point at which flow is maximized before entering into a congested regime. Additionally, and optimal average speed can be obtained from: 



\subsection{Results}

\begin{table}[htbp]
\centering
\caption{Results. Optimal points for each network simulation.}
\label{tab:results-tip-points}
\resizebox{\textwidth}{!}{%
\begin{tabular}{rcccc}
\toprule
\textbf{Network} & \textbf{Net 1} & \textbf{Net 2} & \textbf{Net 3} & \textbf{Net 4} \\ \toprule
\textit{Description} & \multicolumn{1}{r}{\textit{Basic network}} & \textit{2x2 superblocks} & \textit{3x3 superblocks} & \textit{w/ diagonal avenue} \\ \midrule
Max. flow (veh./h) & 989 & 555.8 & 372.8 & 438 \\ \midrule
Density at max. flow (veh./km) & 40.9 & 23.9 & 18.6 & 20.8 \\ \midrule
Optimal speed (km/h) & 24.2 & 23.2 & 19.9 & 21.1 \\ \bottomrule
\end{tabular}%
}
\end{table}






\section{Summary and Outlook}

\bibliographystyle{plain}
\bibliography{references}





\end{document}  



 
